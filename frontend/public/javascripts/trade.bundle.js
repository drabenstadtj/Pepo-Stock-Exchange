document.addEventListener("DOMContentLoaded",(function(){const e=window.apiUrl,t=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),n=document.getElementById("stockSymbol"),o=document.getElementById("stockPrice"),c=document.getElementById("numberOfShares"),l=document.getElementById("totalPrice");if(!t)return alert("User is not authenticated"),void(window.location.href="/signin");const a=document.querySelector('meta[name="balance"]').getAttribute("content");document.getElementById("balance").textContent=s(parseFloat(a).toFixed(2));const d=document.querySelector('meta[name="assets_value"]').getAttribute("content");function u(){const e=parseFloat(document.getElementById("stockPrice").value),t=parseInt(document.getElementById("numberOfShares").value);if(!isNaN(e)&&!isNaN(t)&&t>0){const n=(e*t).toFixed(2);document.getElementById("totalPrice").value=n}else document.getElementById("totalPrice").value=""}function r(n){const o=document.getElementById("stockSymbol").value,c=parseInt(document.getElementById("numberOfShares").value);!o||isNaN(c)||c<=0?alert("Please fill in all fields with valid values"):fetch(`${e}/transactions/${n}`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({stock_symbol:o,quantity:c})}).then((e=>e.json())).then((e=>{alert(e.message||"Transaction successful"),i(),location.reload()})).catch((e=>{alert("Transaction failed"),i()}))}function i(){document.getElementById("stockSymbol").value="",document.getElementById("stockPrice").value="",document.getElementById("numberOfShares").value="",document.getElementById("totalPrice").value=""}function s(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function m(){o.value="",c.value="",l.value=""}document.getElementById("investment").textContent=s(parseFloat(d).toFixed(2)),document.getElementById("stockSymbol").addEventListener("keypress",(function(e){"Enter"===e.key&&(e.preventDefault(),document.getElementById("getPriceButton").click())})),document.getElementById("getPriceButton").addEventListener("click",(function(){const n=document.getElementById("stockSymbol").value;n?fetch(`${e}/stocks/${n}`,{method:"GET",headers:{Authorization:`Bearer ${t}`},credentials:"include"}).then((e=>e.json())).then((e=>{if(e.price){const t=parseFloat(e.price).toFixed(2);document.getElementById("stockPrice").value=t,u()}else alert("Stock not found")})).catch((()=>{alert("Error fetching stock price")})):alert("Please enter a stock symbol")})),document.getElementById("numberOfShares").addEventListener("input",(function(){u()})),document.getElementById("buyButton").addEventListener("click",(function(e){e.preventDefault(),r("buy")})),document.getElementById("sellButton").addEventListener("click",(function(e){e.preventDefault(),r("sell")})),c.addEventListener("input",(()=>{c.value=c.value.split(".")[0]})),n.addEventListener("input",m),document.querySelectorAll(".portfolio-table tbody tr").forEach((e=>{e.addEventListener("click",(function(){const e=this.cells[0].textContent.trim();n.value=e,m()}))}))}));